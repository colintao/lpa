<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†å±‚å®¡æ ¸ç³»ç»Ÿ - Layered Process Audit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background: #0f172a; }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .level-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .level-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        .measure-item {
            animation: slideIn 0.4s ease-out forwards;
            opacity: 0;
            transform: translateX(-10px);
        }
        @keyframes slideIn {
            to { opacity: 1; transform: translateX(0); }
        }
        .check-animation {
            animation: checkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes checkPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .progress-ring { transform: rotate(-90deg); transform-origin: 50% 50%; }
        
        /* ç®¡ç†é¢æ¿æ ·å¼ */
        .admin-sidebar {
            background: rgba(15, 23, 42, 0.95);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .form-input {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #60a5fa;
        }
        
        /* ä¿®å¤ç§»åŠ¨ç«¯ç‚¹å‡»é—®é¢˜ */
        button, input, select {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* æ—¥æœŸé€‰æ‹©å™¨æ ·å¼ä¿®å¤ */
        input[type="date"] {
            position: relative;
            min-height: 44px;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        /* ç¡®ä¿é¢æ¿åœ¨æœ€ä¸Šå±‚ */
        #adminPanel {
            z-index: 9999;
        }
        #detailModal {
            z-index: 9998;
        }
    </style>
<base target="_blank">
</head>
<body class="text-slate-200 min-h-screen overflow-x-hidden">

    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -left-40 w-80 h-80 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
        <div class="absolute -bottom-40 -right-40 w-80 h-80 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse" style="animation-delay: 2s"></div>
    </div>

    <div class="relative max-w-6xl mx-auto p-4 md:p-6">
        
        <!-- å¤´éƒ¨ -->
        <header class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold mb-2">
                    <span class="gradient-text">åˆ†å±‚å®¡æ ¸ç³»ç»Ÿ</span>
                    <span class="text-slate-400 text-lg font-normal ml-2">LPA</span>
                </h1>
                <p class="text-slate-400 text-sm">Layered Process Audit Management</p>
            </div>
            
            <div class="flex gap-3">
                <button onclick="app.openAdminPanel()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-xl transition-all flex items-center gap-2 font-medium border border-slate-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    ç®¡ç†åå°
                </button>
                <div class="flex gap-4 glass-panel rounded-2xl p-3">
                    <div class="text-center px-3 border-r border-slate-600">
                        <div class="text-xl font-bold text-blue-400" id="totalMeasures">0</div>
                        <div class="text-xs text-slate-400">æ€»æªæ–½</div>
                    </div>
                    <div class="text-center px-3 border-r border-slate-600">
                        <div class="text-xl font-bold text-green-400" id="completedToday">0</div>
                        <div class="text-xs text-slate-400">ä»Šæ—¥å®Œæˆ</div>
                    </div>
                    <div class="text-center px-3">
                        <div class="text-xl font-bold text-purple-400" id="pendingToday">0</div>
                        <div class="text-xs text-slate-400">å¾…å®¡æ ¸</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="glass-panel rounded-2xl p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-300 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        é€‰æ‹©æ—¥æœŸ
                    </label>
                    <input type="date" id="datePicker" class="w-full bg-slate-800 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-all">
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-300 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
                        å®¡æ ¸å±‚çº§
                    </label>
                    <select id="levelSelect" class="w-full bg-slate-800 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-all cursor-pointer">
                        <option value="all">å…¨éƒ¨å±‚çº§</option>
                        <option value="dept">ğŸ¢ éƒ¨é—¨çº§ (æ¯å‘¨å››)</option>
                        <option value="line">ğŸ­ äº§çº¿çº§ (æ¯æ—¥)</option>
                        <option value="quality">ğŸ” è´¨é‡çº§ (éšæœº)</option>
                    </select>
                </div>

                <div class="flex gap-3">
                    <button onclick="app.jumpToToday()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white px-4 py-3 rounded-xl transition-all flex items-center justify-center gap-2 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        ä»Šå¤©
                    </button>
                    <button onclick="app.exportReport()" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white px-4 py-3 rounded-xl transition-all flex items-center justify-center gap-2 font-medium shadow-lg shadow-blue-500/25">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        å¯¼å‡º
                    </button>
                </div>
            </div>

            <!-- å½“å‰å‘¨æœŸä¿¡æ¯ -->
            <div class="mt-4 pt-4 border-t border-slate-700/50 grid grid-cols-3 gap-4 text-sm">
                <div class="flex items-center gap-2 text-blue-300">
                    <span class="w-2 h-2 rounded-full bg-blue-400"></span>
                    <span>éƒ¨é—¨çº§å‘¨æœŸï¼š<span id="deptCycleInfo">ç¬¬ 1/5 å‘¨</span></span>
                </div>
                <div class="flex items-center gap-2 text-green-300">
                    <span class="w-2 h-2 rounded-full bg-green-400"></span>
                    <span>äº§çº¿çº§å‘¨æœŸï¼š<span id="lineCycleInfo">ç¬¬ 1/14 å¤©</span></span>
                </div>
                <div class="flex items-center gap-2 text-purple-300">
                    <span class="w-2 h-2 rounded-full bg-purple-400"></span>
                    <span>è´¨é‡çº§è¿›åº¦ï¼š<span id="qualityCycleInfo">0/40 æ¬¡</span></span>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div id="measuresContainer" class="space-y-4"></div>
        <div id="emptyState" class="hidden glass-panel rounded-2xl p-12 text-center">
            <div class="w-24 h-24 mx-auto mb-4 rounded-full bg-slate-800 flex items-center justify-center">
                <svg class="w-12 h-12 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
            </div>
            <h3 class="text-xl font-semibold text-slate-300 mb-2">è¯¥å±‚çº§ä»Šæ—¥æ— å®¡æ ¸ä»»åŠ¡</h3>
            <p class="text-slate-500">è¯·åˆ‡æ¢æ—¥æœŸæˆ–å±‚çº§æŸ¥çœ‹å…¶ä»–å®¡æ ¸è®¡åˆ’</p>
        </div>
    </div>

    <!-- ç®¡ç†åå°é¢æ¿ -->
    <div id="adminPanel" class="fixed inset-0 z-[9999] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="app.closeAdminPanel()"></div>
        
        <div class="absolute right-0 top-0 h-full w-full md:w-[700px] admin-sidebar shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col" id="adminSidebar">
            
            <!-- å¤´éƒ¨ -->
            <div class="p-6 border-b border-slate-700 flex justify-between items-center bg-slate-900/50">
                <div>
                    <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                        ç®¡ç†åå°
                    </h2>
                    <p class="text-slate-400 text-sm mt-1">æ£€æŸ¥é¡¹ç®¡ç†ä¸ç³»ç»Ÿè®¾ç½®</p>
                </div>
                <button onclick="app.closeAdminPanel()" class="text-slate-400 hover:text-white p-2 hover:bg-slate-800 rounded-lg transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- æ ‡ç­¾åˆ‡æ¢ -->
            <div class="flex border-b border-slate-700 bg-slate-900/30">
                <button onclick="app.switchAdminTab('measures')" id="tab-measures" class="flex-1 py-4 text-sm font-medium text-slate-300 hover:text-white tab-active transition-colors">
                    ğŸ“‹ æ£€æŸ¥é¡¹ç®¡ç†
                </button>
                <button onclick="app.switchAdminTab('frequency')" id="tab-frequency" class="flex-1 py-4 text-sm font-medium text-slate-300 hover:text-white transition-colors">
                    âš™ï¸ é¢‘æ¬¡è®¾ç½®
                </button>
                <button onclick="app.switchAdminTab('data')" id="tab-data" class="flex-1 py-4 text-sm font-medium text-slate-300 hover:text-white transition-colors">
                    ğŸ’¾ æ•°æ®ç®¡ç†
                </button>
            </div>

            <!-- å†…å®¹åŒº -->
            <div class="flex-1 overflow-y-auto p-6" id="adminContent">
                
                <!-- æ£€æŸ¥é¡¹ç®¡ç† -->
                <div id="view-measures" class="space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-white">æ£€æŸ¥é¡¹åˆ—è¡¨</h3>
                        <button onclick="app.addNewMeasure()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-sm text-white transition-all flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            æ–°å¢æ£€æŸ¥é¡¹
                        </button>
                    </div>

                    <div class="flex gap-2 mb-4">
                        <input type="text" id="searchMeasures" placeholder="æœç´¢æ£€æŸ¥é¡¹..." class="flex-1 form-input rounded-lg px-4 py-2 text-white text-sm" oninput="app.renderMeasuresList()">
                        <select id="filterCategory" class="form-input rounded-lg px-3 py-2 text-white text-sm" onchange="app.renderMeasuresList()">
                            <option value="all">å…¨éƒ¨ç±»åˆ«</option>
                            <option value="å®‰å…¨">å®‰å…¨</option>
                            <option value="è´¨é‡">è´¨é‡</option>
                            <option value="äº¤ä»˜">äº¤ä»˜</option>
                            <option value="æˆæœ¬">æˆæœ¬</option>
                            <option value="äººå‘˜">äººå‘˜</option>
                            <option value="è®¾å¤‡">è®¾å¤‡</option>
                        </select>
                    </div>
                    
                    <div id="measuresList" class="space-y-3">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- é¢‘æ¬¡è®¾ç½® -->
                <div id="view-frequency" class="hidden space-y-6">
                    <div class="p-4 rounded-xl bg-blue-500/10 border border-blue-500/20 mb-4">
                        <p class="text-sm text-blue-200">ğŸ’¡ ä»¥ä¸‹è®¾ç½®ä¸ºå…¨å±€é»˜è®¤ï¼Œåº”ç”¨äºæ‰€æœ‰æ£€æŸ¥é¡¹ã€‚ä¿®æ”¹åæ‰€æœ‰æ£€æŸ¥é¡¹æŒ‰æ–°é¢‘æ¬¡æ‰§è¡Œã€‚</p>
                    </div>

                    <!-- éƒ¨é—¨çº§è®¾ç½® -->
                    <div class="glass-panel rounded-xl p-6 space-y-4">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">ğŸ¢</span>
                            <div>
                                <h4 class="text-lg font-semibold text-white">éƒ¨é—¨çº§è®¾ç½®</h4>
                                <p class="text-sm text-slate-400">æ¯å‘¨å›ºå®šæ—¥æœŸæ£€æŸ¥ï¼Œå¤šå‘¨å¾ªç¯</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-slate-300 mb-2">å›ºå®šæ£€æŸ¥æ—¥</label>
                                <select id="settingDeptDay" class="w-full form-input rounded-lg px-3 py-2 text-white" onchange="app.updateFrequencySettings()">
                                    <option value="1">æ¯å‘¨ä¸€</option>
                                    <option value="2">æ¯å‘¨äºŒ</option>
                                    <option value="3">æ¯å‘¨ä¸‰</option>
                                    <option value="4" selected>æ¯å‘¨å››</option>
                                    <option value="5">æ¯å‘¨äº”</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-slate-300 mb-2">å¾ªç¯å‘¨æ•°</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="settingDeptWeeks" value="5" min="1" max="10" class="w-full form-input rounded-lg px-3 py-2 text-white" onchange="app.updateFrequencySettings()">
                                    <span class="text-slate-400 text-sm whitespace-nowrap">å‘¨å¾ªç¯</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-slate-500">å½“å‰ï¼šæ¯å‘¨å››æ£€æŸ¥ï¼Œ5å‘¨ä¸ºä¸€ä¸ªå®Œæ•´å¾ªç¯å‘¨æœŸ</p>
                    </div>

                    <!-- äº§çº¿çº§è®¾ç½® -->
                    <div class="glass-panel rounded-xl p-6 space-y-4">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">ğŸ­</span>
                            <div>
                                <h4 class="text-lg font-semibold text-white">äº§çº¿çº§è®¾ç½®</h4>
                                <p class="text-sm text-slate-400">æ¯æ—¥æ£€æŸ¥ï¼ŒæŒç»­å›ºå®šå¤©æ•°</p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-slate-300 mb-2">æŒç»­å¤©æ•°ï¼ˆå‘¨æœŸé•¿åº¦ï¼‰</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="settingLineDays" value="14" min="7" max="30" class="w-full form-input rounded-lg px-3 py-2 text-white" onchange="app.updateFrequencySettings()">
                                <span class="text-slate-400 text-sm whitespace-nowrap">å¤©ï¼ˆ2å‘¨ï¼‰</span>
                            </div>
                        </div>
                        <p class="text-xs text-slate-500">å½“å‰ï¼šæ¯å¤©æ£€æŸ¥ï¼Œ14å¤©ï¼ˆ2å‘¨ï¼‰ä¸ºä¸€ä¸ªå®Œæ•´å¾ªç¯å‘¨æœŸ</p>
                    </div>

                    <!-- è´¨é‡çº§è®¾ç½® -->
                    <div class="glass-panel rounded-xl p-6 space-y-4">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">ğŸ”</span>
                            <div>
                                <h4 class="text-lg font-semibold text-white">è´¨é‡çº§è®¾ç½®</h4>
                                <p class="text-sm text-slate-400">å…¨å¹´éšæœºæŠ½æŸ¥ï¼Œå›ºå®šæ¬¡æ•°</p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-slate-300 mb-2">å…¨å¹´æ£€æŸ¥æ¬¡æ•°</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="settingQualityCount" value="40" min="1" max="100" class="w-full form-input rounded-lg px-3 py-2 text-white" onchange="app.updateFrequencySettings()">
                                <span class="text-slate-400 text-sm whitespace-nowrap">æ¬¡/å¹´</span>
                            </div>
                        </div>
                        <p class="text-xs text-slate-500">å½“å‰ï¼šå…¨å¹´éšæœºæŠ½æŸ¥40æ¬¡ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†é…æ—¥æœŸ</p>
                    </div>
                </div>

                <!-- æ•°æ®ç®¡ç† -->
                <div id="view-data" class="hidden space-y-6">
                    <div class="glass-panel rounded-xl p-6 space-y-4">
                        <h4 class="text-lg font-medium text-white mb-4">æ•°æ®å¤‡ä»½ä¸æ¢å¤</h4>
                        
                        <div class="flex justify-between items-center p-4 rounded-lg bg-slate-800/50 border border-slate-700">
                            <div>
                                <div class="text-sm font-medium text-slate-200">å¯¼å‡ºæ‰€æœ‰æ•°æ®</div>
                                <div class="text-xs text-slate-400">åŒ…å«æ£€æŸ¥é¡¹ã€å®¡æ ¸è®°å½•ã€è®¾ç½®</div>
                            </div>
                            <button onclick="app.backupData()" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm text-white transition-colors">
                                å¯¼å‡ºå¤‡ä»½
                            </button>
                        </div>

                        <div class="flex justify-between items-center p-4 rounded-lg bg-slate-800/50 border border-slate-700">
                            <div>
                                <div class="text-sm font-medium text-slate-200">å¯¼å…¥æ•°æ®</div>
                                <div class="text-xs text-slate-400">ä»JSONæ–‡ä»¶æ¢å¤æ•°æ®</div>
                            </div>
                            <label class="px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-sm text-white transition-colors cursor-pointer">
                                é€‰æ‹©æ–‡ä»¶
                                <input type="file" accept=".json" class="hidden" onchange="app.restoreData(this)">
                            </label>
                        </div>

                        <div class="pt-4 border-t border-slate-700">
                            <button onclick="app.clearAllData()" class="w-full px-4 py-3 rounded-xl border border-red-500/50 text-red-400 hover:bg-red-500/10 transition-all text-sm">
                                âš ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆä¸å¯æ¢å¤ï¼‰
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ç¼–è¾‘æ£€æŸ¥é¡¹è¡¨å•ï¼ˆéšè—ï¼‰ -->
                <div id="view-edit" class="hidden space-y-6">
                    <div class="flex items-center gap-2 mb-4">
                        <button onclick="app.switchAdminTab('measures')" class="text-slate-400 hover:text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <h3 class="text-lg font-medium text-white" id="editFormTitle">æ–°å¢æ£€æŸ¥é¡¹</h3>
                    </div>

                    <form id="measureForm" onsubmit="app.saveMeasure(event)" class="space-y-4">
                        <input type="hidden" id="editId">
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">æ£€æŸ¥é¡¹åç§° <span class="text-red-400">*</span></label>
                            <input type="text" id="measureName" required class="w-full form-input rounded-xl px-4 py-3 text-white" placeholder="ä¾‹å¦‚ï¼šæ£€æŸ¥è®¾å¤‡ç‚¹æ£€è®°å½•å®Œæ•´æ€§">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">æ‰€å±ç±»åˆ« <span class="text-red-400">*</span></label>
                            <select id="measureCategory" required class="w-full form-input rounded-xl px-4 py-3 text-white">
                                <option value="">è¯·é€‰æ‹©...</option>
                                <option value="å®‰å…¨">å®‰å…¨</option>
                                <option value="è´¨é‡">è´¨é‡</option>
                                <option value="äº¤ä»˜">äº¤ä»˜</option>
                                <option value="æˆæœ¬">æˆæœ¬</option>
                                <option value="äººå‘˜">äººå‘˜</option>
                                <option value="è®¾å¤‡">è®¾å¤‡</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">æ£€æŸ¥æ ‡å‡†æè¿°</label>
                            <textarea id="measureDesc" rows="3" class="w-full form-input rounded-xl px-4 py-3 text-white text-sm" placeholder="è¯¦ç»†æè¿°æ£€æŸ¥å†…å®¹ã€åˆ¤å®šæ ‡å‡†..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">è´£ä»»å²—ä½</label>
                            <input type="text" id="measureOwner" class="w-full form-input rounded-xl px-4 py-3 text-white text-sm" placeholder="ä¾‹å¦‚ï¼šç­ç»„é•¿ã€è´¨é‡å·¥ç¨‹å¸ˆ">
                        </div>

                        <!-- æ ‡ç­¾ç³»ç»Ÿ -->
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">æ ‡ç­¾</label>
                            <div class="flex flex-wrap gap-2 mb-2" id="tagsContainer"></div>
                            <div class="flex gap-2">
                                <input type="text" id="newTag" class="flex-1 form-input rounded-lg px-3 py-2 text-white text-sm" placeholder="æ·»åŠ æ ‡ç­¾..." onkeypress="if(event.key==='Enter'){app.addTag();event.preventDefault();}">
                                <button type="button" onclick="app.addTag()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors">æ·»åŠ </button>
                            </div>
                        </div>

                        <div class="flex items-center gap-2 p-3 rounded-lg bg-slate-800/30 border border-slate-700">
                            <input type="checkbox" id="measureActive" checked class="w-4 h-4 rounded border-slate-600 text-blue-500 focus:ring-blue-500 bg-slate-700">
                            <label for="measureActive" class="text-sm text-slate-300">å¯ç”¨æ­¤æ£€æŸ¥é¡¹ï¼ˆåŒæ—¶åœ¨ä¸‰ä¸ªå±‚çº§æŒ‰è®¾å®šé¢‘æ¬¡æ£€æŸ¥ï¼‰</label>
                        </div>

                        <!-- æ˜¾ç¤ºå½“å‰é¢‘æ¬¡è®¾ç½®ï¼ˆåªè¯»ï¼‰ -->
                        <div class="p-4 rounded-xl bg-slate-800/50 border border-slate-700 space-y-2">
                            <h4 class="text-sm font-medium text-slate-300 mb-2">å½“å‰å…¨å±€é¢‘æ¬¡è®¾ç½®</h4>
                            <div class="flex items-center gap-2 text-xs text-slate-400">
                                <span class="w-2 h-2 rounded-full bg-blue-400"></span>
                                <span>éƒ¨é—¨çº§ï¼šæ¯å‘¨<span id="previewDeptDay">å››</span>ï¼Œ<span id="previewDeptWeeks">5</span>å‘¨å¾ªç¯</span>
                            </div>
                            <div class="flex items-center gap-2 text-xs text-slate-400">
                                <span class="w-2 h-2 rounded-full bg-green-400"></span>
                                <span>äº§çº¿çº§ï¼šæ¯å¤©ï¼Œ<span id="previewLineDays">14</span>å¤©å¾ªç¯</span>
                            </div>
                            <div class="flex items-center gap-2 text-xs text-slate-400">
                                <span class="w-2 h-2 rounded-full bg-purple-400"></span>
                                <span>è´¨é‡çº§ï¼šå…¨å¹´<span id="previewQualityCount">40</span>æ¬¡éšæœº</span>
                            </div>
                            <p class="text-xs text-blue-400 mt-2">ğŸ’¡ å¦‚éœ€ä¿®æ”¹é¢‘æ¬¡ï¼Œè¯·å‰å¾€"é¢‘æ¬¡è®¾ç½®"æ ‡ç­¾é¡µ</p>
                        </div>

                        <div class="flex gap-3 pt-4 border-t border-slate-700">
                            <button type="button" onclick="app.switchAdminTab('measures')" class="flex-1 px-4 py-3 rounded-xl border border-slate-600 text-slate-300 hover:bg-slate-800 transition-all">
                                å–æ¶ˆ
                            </button>
                            <button type="submit" class="flex-1 px-4 py-3 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-medium shadow-lg shadow-blue-500/25 transition-all">
                                ä¿å­˜æ£€æŸ¥é¡¹
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- å®¡æ ¸è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="detailModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-[9998] flex items-center justify-center p-4">
        <div class="glass-panel rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 transform transition-all scale-95 opacity-0" id="modalContent">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <span id="modalLevelBadge" class="inline-block px-3 py-1 rounded-full text-xs font-medium"></span>
                        <span id="modalCycleInfo" class="text-xs text-slate-400"></span>
                    </div>
                    <h2 id="modalTitle" class="text-2xl font-bold text-white"></h2>
                </div>
                <button onclick="app.closeModal()" class="text-slate-400 hover:text-white transition-colors p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="modalBody" class="space-y-4"></div>
            <div class="mt-6 pt-6 border-t border-slate-700 flex justify-end gap-3">
                <button onclick="app.closeModal()" class="px-4 py-2 rounded-lg text-slate-300 hover:text-white transition-colors">å…³é—­</button>
                <button onclick="app.saveCheck()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-all shadow-lg shadow-blue-500/25">ä¿å­˜è®°å½•</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€ app å˜é‡
        let app;

        // ç¡®ä¿ DOM åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        function initApp() {
            app = new LayeredAuditApp();
        }

        class LayeredAuditApp {
            constructor() {
                // é»˜è®¤é¢‘æ¬¡è®¾ç½®
                this.defaultSettings = {
                    deptDay: 4,        // å‘¨å››(1-5)
                    deptWeeks: 5,      // 5å‘¨å¾ªç¯
                    lineDays: 14,      // 14å¤©(2å‘¨)
                    qualityCount: 40   // å…¨å¹´40æ¬¡
                };
                
                this.settings = this.loadSettings();
                this.measures = this.loadMeasures();
                this.currentDate = new Date();
                this.selectedLevel = 'all';
                this.checks = JSON.parse(localStorage.getItem('lpa_checks') || '{}');
                this.qualitySchedule = {};
                this.currentTags = [];
                this.currentDetail = null;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.generateQualitySchedule();
                this.render();
                this.updateStats();
                this.updateCycleInfo();
            }

            loadSettings() {
                const saved = localStorage.getItem('lpa_settings');
                return saved ? JSON.parse(saved) : { ...this.defaultSettings };
            }

            saveSettings() {
                localStorage.setItem('lpa_settings', JSON.stringify(this.settings));
                this.generateQualitySchedule();
                this.render();
                this.updateCycleInfo();
            }

            loadMeasures() {
                const saved = localStorage.getItem('lpa_measures');
                if (saved) {
                    const measures = JSON.parse(saved);
                    if (measures.length > 0) return measures;
                }
                
                // é»˜è®¤ç¤ºä¾‹æ•°æ® - 8æ¡æµ‹è¯•æ•°æ®
                return [
                    { 
                        id: 'm-1', 
                        category: 'å®‰å…¨', 
                        action: 'æ£€æŸ¥è®¾å¤‡ç‚¹æ£€è®°å½•å®Œæ•´æ€§', 
                        desc: 'ç¡®è®¤æ‰€æœ‰è®¾å¤‡ç‚¹æ£€è¡¨å·²æŒ‰æ—¶å¡«å†™ï¼Œæ— é—æ¼é¡¹ï¼Œå‘ç°å¼‚å¸¸åŠæ—¶ä¸ŠæŠ¥', 
                        owner: 'éƒ¨é—¨ç»ç†', 
                        tags: ['è®¾å¤‡', 'è®°å½•', 'æ—¥å¸¸'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    { 
                        id: 'm-2', 
                        category: 'è´¨é‡', 
                        action: 'éªŒè¯é˜²é”™è£…ç½®æœ‰æ•ˆæ€§', 
                        desc: 'æ£€æŸ¥é˜²é”™è£…ç½®åŠŸèƒ½æ­£å¸¸ï¼Œæ— å¤±æ•ˆæƒ…å†µï¼Œæµ‹è¯•æŠ¥è­¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸', 
                        owner: 'è´¨é‡å·¥ç¨‹å¸ˆ', 
                        tags: ['é˜²é”™', 'ç‚¹æ£€', 'å…³é”®'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    { 
                        id: 'm-3', 
                        category: 'äº¤ä»˜', 
                        action: 'ç¡®è®¤ç‰©æ–™å…ˆè¿›å…ˆå‡ºæ‰§è¡Œ', 
                        desc: 'æ£€æŸ¥ç‰©æ–™FIFOæ‰§è¡Œæƒ…å†µï¼Œæ ‡è¯†æ¸…æ™°ï¼Œæ— è¿‡æœŸç‰©æ–™æ»ç•™', 
                        owner: 'ä»“åº“ä¸»ç®¡', 
                        tags: ['FIFO', 'ç‰©æ–™', 'ä»“å‚¨'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    { 
                        id: 'm-4', 
                        category: 'äººå‘˜', 
                        action: 'æ£€æŸ¥å‘˜å·¥åŠ³ä¿ç”¨å“ä½©æˆ´', 
                        desc: 'ç¡®è®¤æ‰€æœ‰åœ¨å²—å‘˜å·¥æ­£ç¡®ä½©æˆ´å®‰å…¨å¸½ã€é˜²æŠ¤çœ¼é•œã€åŠ³ä¿é‹ç­‰é˜²æŠ¤ç”¨å“', 
                        owner: 'ç­ç»„é•¿', 
                        tags: ['å®‰å…¨', 'åŠ³ä¿', 'äººå‘˜'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    { 
                        id: 'm-5', 
                        category: 'è®¾å¤‡', 
                        action: 'ç¡®è®¤è®¾å¤‡ç»´æŠ¤ä¿å…»è®°å½•', 
                        desc: 'æ£€æŸ¥è®¾å¤‡å®šæœŸä¿å…»æ˜¯å¦æŒ‰è®¡åˆ’æ‰§è¡Œï¼Œä¿å…»è®°å½•å®Œæ•´å‡†ç¡®', 
                        owner: 'è®¾å¤‡å·¥ç¨‹å¸ˆ', 
                        tags: ['è®¾å¤‡', 'ä¿å…»', 'è®¡åˆ’'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    { 
                        id: 'm-6', 
                        category: 'æˆæœ¬', 
                        action: 'æ£€æŸ¥ç‰©æ–™æŸè€—æ§åˆ¶æƒ…å†µ', 
                        desc: 'ç¡®è®¤ç‰©æ–™é¢†ç”¨è®°å½•å®Œæ•´ï¼ŒæŸè€—ç‡åœ¨æ§åˆ¶èŒƒå›´å†…ï¼Œæ— æµªè´¹ç°è±¡', 
                        owner: 'ç”Ÿäº§ä¸»ç®¡', 
                        tags: ['æˆæœ¬', 'ç‰©æ–™', 'æ§åˆ¶'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    { 
                        id: 'm-7', 
                        category: 'è´¨é‡', 
                        action: 'å®¡æ ¸ä¸åˆæ ¼å“å¤„ç†æµç¨‹', 
                        desc: 'æ£€æŸ¥ä¸åˆæ ¼å“æ ‡è¯†ã€éš”ç¦»ã€è®°å½•æ˜¯å¦è§„èŒƒï¼Œå¤„ç†æµç¨‹æ˜¯å¦ç¬¦åˆè¦æ±‚', 
                        owner: 'è´¨é‡ç»ç†', 
                        tags: ['è´¨é‡', 'ä¸åˆæ ¼å“', 'æµç¨‹'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    { 
                        id: 'm-8', 
                        category: 'å®‰å…¨', 
                        action: 'æ£€æŸ¥æ¶ˆé˜²å™¨ææœ‰æ•ˆæ€§', 
                        desc: 'ç¡®è®¤ç­ç«å™¨ã€æ¶ˆé˜²æ “ç­‰å™¨æåœ¨æœ‰æ•ˆæœŸå†…ï¼Œå‹åŠ›æ­£å¸¸ï¼Œæ— é®æŒ¡', 
                        owner: 'å®‰å…¨å‘˜', 
                        tags: ['æ¶ˆé˜²', 'å®‰å…¨', 'åº”æ€¥'], 
                        active: true,
                        createdAt: new Date().toISOString()
                    }
                ];
            }

            saveMeasures() {
                localStorage.setItem('lpa_measures', JSON.stringify(this.measures));
                this.generateQualitySchedule();
                this.render();
                this.updateStats();
            }

            setupEventListeners() {
                // æ—¥æœŸé€‰æ‹©å™¨ - è®¾ç½®é»˜è®¤ä¸ºä»Šå¤©
                const datePicker = document.getElementById('datePicker');
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                datePicker.value = `${yyyy}-${mm}-${dd}`;
                
                datePicker.addEventListener('change', (e) => {
                    this.currentDate = new Date(e.target.value);
                    this.render();
                    this.updateStats();
                    this.updateCycleInfo();
                });

                // å±‚çº§é€‰æ‹©å™¨
                const levelSelect = document.getElementById('levelSelect');
                levelSelect.addEventListener('change', (e) => {
                    this.selectedLevel = e.target.value;
                    this.render();
                    this.updateStats();
                });

                // åˆå§‹åŒ–é¢‘æ¬¡è®¾ç½®ç•Œé¢
                document.getElementById('settingDeptDay').value = this.settings.deptDay;
                document.getElementById('settingDeptWeeks').value = this.settings.deptWeeks;
                document.getElementById('settingLineDays').value = this.settings.lineDays;
                document.getElementById('settingQualityCount').value = this.settings.qualityCount;
            }

            // ç”Ÿæˆè´¨é‡çº§å…¨å¹´éšæœºè®¡åˆ’
            generateQualitySchedule() {
                const schedule = {};
                const year = new Date().getFullYear();
                const measures = this.measures.filter(m => m.active);
                
                measures.forEach(measure => {
                    const dates = [];
                    const count = this.settings.qualityCount;
                    const daysInYear = 365;
                    const interval = Math.floor(daysInYear / count);
                    
                    for (let i = 0; i < count; i++) {
                        const baseDay = i * interval;
                        const randomOffset = Math.floor(Math.random() * (interval * 0.6)) - Math.floor(interval * 0.3);
                        const dayOfYear = Math.max(0, Math.min(364, baseDay + randomOffset));
                        
                        const date = new Date(year, 0, dayOfYear + 1);
                        const dateStr = date.toISOString().split('T')[0];
                        dates.push(dateStr);
                    }
                    
                    dates.sort();
                    schedule[measure.id] = dates;
                });
                
                this.qualitySchedule = schedule;
            }

            shouldShowMeasure(measure, level, date) {
                if (!measure.active) return false;
                
                const dateStr = date.toISOString().split('T')[0];
                const dayOfWeek = date.getDay() || 7;
                
                const startOfYear = new Date(date.getFullYear(), 0, 0);
                const dayOfYear = Math.floor((date - startOfYear) / (1000 * 60 * 60 * 24));

                switch(level) {
                    case 'dept':
                        if (dayOfWeek !== parseInt(this.settings.deptDay)) return false;
                        const weekNum = Math.ceil(dayOfYear / 7);
                        return (weekNum % this.settings.deptWeeks) !== 0 || weekNum <= this.settings.deptWeeks;
                    
                    case 'line':
                        return true;
                    
                    case 'quality':
                        return this.qualitySchedule[measure.id]?.includes(dateStr);
                    
                    default:
                        return false;
                }
            }

            getCheckStatus(measureId, level, dateStr) {
                const key = `${measureId}-${level}-${dateStr}`;
                return this.checks[key] || { completed: false, count: 0, note: '' };
            }

            getCycleInfo(level, date) {
                const startOfYear = new Date(date.getFullYear(), 0, 0);
                const dayOfYear = Math.floor((date - startOfYear) / (1000 * 60 * 60 * 24));
                const weekNum = Math.ceil(dayOfYear / 7);
                
                switch(level) {
                    case 'dept':
                        const deptWeekInCycle = ((weekNum - 1) % this.settings.deptWeeks) + 1;
                        return `ç¬¬ ${deptWeekInCycle}/${this.settings.deptWeeks} å‘¨`;
                    
                    case 'line':
                        const dayInCycle = (dayOfYear % this.settings.lineDays) + 1;
                        return `ç¬¬ ${dayInCycle}/${this.settings.lineDays} å¤©`;
                    
                    case 'quality':
                        const passedDays = dayOfYear;
                        const estimatedDone = Math.floor((passedDays / 365) * this.settings.qualityCount);
                        return `çº¦ ${estimatedDone}/${this.settings.qualityCount} æ¬¡`;
                    
                    default:
                        return '';
                }
            }

            updateCycleInfo() {
                document.getElementById('deptCycleInfo').textContent = this.getCycleInfo('dept', this.currentDate);
                document.getElementById('lineCycleInfo').textContent = this.getCycleInfo('line', this.currentDate);
                document.getElementById('qualityCycleInfo').textContent = this.getCycleInfo('quality', this.currentDate);
            }

            render() {
                const container = document.getElementById('measuresContainer');
                const emptyState = document.getElementById('emptyState');
                const dateStr = this.currentDate.toISOString().split('T')[0];
                
                let html = '';
                let hasContent = false;
                
                const levels = this.selectedLevel === 'all' 
                    ? ['dept', 'line', 'quality'] 
                    : [this.selectedLevel];
                
                const levelNames = { dept: 'éƒ¨é—¨çº§', line: 'äº§çº¿çº§', quality: 'è´¨é‡çº§' };
                const levelColors = { dept: 'blue', line: 'green', quality: 'purple' };
                const levelIcons = { dept: 'ğŸ¢', line: 'ğŸ­', quality: 'ğŸ”' };
                
                levels.forEach((level, levelIndex) => {
                    const levelMeasures = this.measures.filter(m => this.shouldShowMeasure(m, level, this.currentDate));
                    
                    if (levelMeasures.length > 0) {
                        hasContent = true;
                        
                        html += `
                            <div class="flex items-center gap-3 mb-4 mt-6 first:mt-0">
                                <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-${levelColors[level]}-500/20 border border-${levelColors[level]}-500/30">
                                    <span class="text-xl">${levelIcons[level]}</span>
                                    <span class="font-medium text-${levelColors[level]}-300">${levelNames[level]}</span>
                                    <span class="text-xs text-${levelColors[level]}-400 ml-2">${this.getCycleInfo(level, this.currentDate)}</span>
                                </div>
                                <div class="flex-1 h-px bg-slate-700"></div>
                                <span class="text-xs text-slate-500">${levelMeasures.length} é¡¹</span>
                            </div>
                        `;
                        
                        html += levelMeasures.map((m, index) => {
                            const status = this.getCheckStatus(m.id, level, dateStr);
                            const progress = this.calculateProgress(level, status);
                            
                            return `
                                <div class="glass-panel rounded-2xl p-5 level-card cursor-pointer measure-item" 
                                     style="animation-delay: ${(levelIndex * 0.1) + (index * 0.05)}s"
                                     onclick="app.openDetail('${m.id}', '${level}')">
                                    <div class="flex items-start justify-between gap-4">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2 mb-2 flex-wrap">
                                                <span class="px-2 py-0.5 rounded text-xs bg-slate-700 text-slate-300">${m.category}</span>
                                                ${m.tags?.map(t => `<span class="px-2 py-0.5 rounded text-xs bg-slate-800 text-slate-400 border border-slate-700">#${t}</span>`).join('') || ''}
                                            </div>
                                            <h3 class="text-lg font-semibold text-white mb-2">${m.action}</h3>
                                            <div class="flex items-center gap-3 text-xs text-slate-400">
                                                ${m.owner ? `<span class="flex items-center gap-1"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>${m.owner}</span>` : ''}
                                            </div>
                                        </div>
                                        
                                        <div class="flex flex-col items-end gap-2">
                                            <div class="relative w-14 h-14">
                                                <svg class="w-14 h-14 progress-ring">
                                                    <circle cx="28" cy="28" r="24" stroke="currentColor" stroke-width="3" fill="none" class="text-slate-700"></circle>
                                                    <circle cx="28" cy="28" r="24" stroke="currentColor" stroke-width="3" fill="none" 
                                                            class="text-${levelColors[level]}-500 transition-all duration-1000"
                                                            stroke-dasharray="${2 * Math.PI * 24}"
                                                            stroke-dashoffset="${2 * Math.PI * 24 * (1 - progress)}"></circle>
                                                </svg>
                                                <div class="absolute inset-0 flex items-center justify-center text-xs font-bold">
                                                    ${Math.round(progress * 100)}%
                                                </div>
                                            </div>
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${status.completed ? 'bg-green-500/20 text-green-400 border border-green-500/30' : 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'}">
                                                ${status.completed ? 'âœ“' : 'â³'}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    ${level === 'dept' && !status.completed ? `
                                        <div class="mt-4 pt-3 border-t border-slate-700/50 flex gap-2">
                                            ${Array.from({length: 5}, (_, i) => `
                                                <button onclick="event.stopPropagation(); app.quickCheck('${m.id}', 'dept', ${i})" 
                                                        class="w-8 h-8 rounded-lg border-2 ${status.count > i ? 'bg-blue-500 border-blue-500 text-white' : 'border-slate-600 hover:border-blue-500'} transition-all flex items-center justify-center text-xs">
                                                    ${status.count > i ? 'âœ“' : i + 1}
                                                </button>
                                            `).join('')}
                                            <span class="ml-2 text-xs text-slate-500 self-center">éƒ¨é—¨çº§éœ€ç¡®è®¤5æ¬¡</span>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('');
                    }
                });
                
                if (!hasContent) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    container.innerHTML = html;
                }
            }

            calculateProgress(level, status) {
                switch(level) {
                    case 'dept':
                        return (status.count || 0) / 5;
                    case 'line':
                        return status.completed ? 1 : 0;
                    case 'quality':
                        return status.completed ? 1 : 0;
                    default:
                        return 0;
                }
            }

            // ç®¡ç†é¢æ¿åŠŸèƒ½
            openAdminPanel() {
                const panel = document.getElementById('adminPanel');
                const sidebar = document.getElementById('adminSidebar');
                
                panel.classList.remove('hidden');
                // å¼ºåˆ¶é‡ç»˜
                void panel.offsetWidth;
                
                setTimeout(() => {
                    sidebar.classList.remove('translate-x-full');
                }, 10);
                
                this.renderMeasuresList();
            }

            closeAdminPanel() {
                const sidebar = document.getElementById('adminSidebar');
                const panel = document.getElementById('adminPanel');
                
                sidebar.classList.add('translate-x-full');
                
                setTimeout(() => {
                    panel.classList.add('hidden');
                }, 300);
            }

            switchAdminTab(tab) {
                ['measures', 'frequency', 'data', 'edit'].forEach(t => {
                    const el = document.getElementById(`view-${t}`);
                    if (el) el.classList.add('hidden');
                    const tabEl = document.getElementById(`tab-${t}`);
                    if (tabEl) tabEl.classList.remove('tab-active');
                });
                
                document.getElementById(`view-${tab}`).classList.remove('hidden');
                const tabBtn = document.getElementById(`tab-${tab}`);
                if (tabBtn) tabBtn.classList.add('tab-active');
                
                if (tab === 'measures') this.renderMeasuresList();
                if (tab === 'frequency') this.updateFrequencyPreview();
            }

            updateFrequencyPreview() {
                const dayNames = ['', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”'];
                document.getElementById('previewDeptDay').textContent = dayNames[this.settings.deptDay] || 'å››';
                document.getElementById('previewDeptWeeks').textContent = this.settings.deptWeeks;
                document.getElementById('previewLineDays').textContent = this.settings.lineDays;
                document.getElementById('previewQualityCount').textContent = this.settings.qualityCount;
            }

            renderMeasuresList() {
                const container = document.getElementById('measuresList');
                const search = document.getElementById('searchMeasures').value.toLowerCase();
                const category = document.getElementById('filterCategory').value;
                
                let filtered = this.measures.filter(m => {
                    const matchSearch = !search || m.action.toLowerCase().includes(search);
                    const matchCategory = category === 'all' || m.category === category;
                    return matchSearch && matchCategory;
                });

                if (filtered.length === 0) {
                    container.innerHTML = '<div class="text-center text-slate-500 py-8">æš‚æ— æ£€æŸ¥é¡¹</div>';
                    return;
                }

                container.innerHTML = filtered.map(m => `
                    <div class="group flex items-center justify-between p-4 rounded-xl bg-slate-800/50 border border-slate-700 hover:border-slate-600 transition-all">
                        <div class="flex items-center gap-3 flex-1 cursor-pointer" onclick="app.editMeasure('${m.id}')">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-medium text-white truncate">${m.action}</span>
                                    ${!m.active ? '<span class="px-2 py-0.5 rounded text-xs bg-red-500/20 text-red-400 border border-red-500/30">å·²åœç”¨</span>' : ''}
                                </div>
                                <div class="flex items-center gap-2 text-xs text-slate-400">
                                    <span class="px-2 py-0.5 rounded bg-slate-700">${m.category}</span>
                                    ${m.owner ? `<span>â€¢ ${m.owner}</span>` : ''}
                                    <span class="text-slate-500">â€¢ ä¸‰å±‚çº§åŒæ—¶æ£€æŸ¥</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="event.stopPropagation(); app.toggleMeasureActive('${m.id}')" class="p-2 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white" title="${m.active ? 'åœç”¨' : 'å¯ç”¨'}">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${m.active ? 'M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z' : 'M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z M21 12a9 9 0 11-18 0 9 9 0 0118 0z'}"></path></svg>
                            </button>
                            <button onclick="event.stopPropagation(); app.deleteMeasure('${m.id}')" class="p-2 hover:bg-red-500/20 rounded-lg text-slate-400 hover:text-red-400" title="åˆ é™¤">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            updateFrequencySettings() {
                this.settings.deptDay = parseInt(document.getElementById('settingDeptDay').value) || 4;
                this.settings.deptWeeks = parseInt(document.getElementById('settingDeptWeeks').value) || 5;
                this.settings.lineDays = parseInt(document.getElementById('settingLineDays').value) || 14;
                this.settings.qualityCount = parseInt(document.getElementById('settingQualityCount').value) || 40;
                
                this.saveSettings();
                this.showToast('é¢‘æ¬¡è®¾ç½®å·²æ›´æ–°');
            }

            addNewMeasure() {
                document.getElementById('editId').value = '';
                document.getElementById('measureForm').reset();
                document.getElementById('editFormTitle').textContent = 'æ–°å¢æ£€æŸ¥é¡¹';
                document.getElementById('measureActive').checked = true;
                this.currentTags = [];
                this.renderTags();
                this.updateFrequencyPreview();
                this.switchAdminTab('edit');
            }

            editMeasure(id) {
                const m = this.measures.find(x => x.id === id);
                if (!m) return;

                document.getElementById('editId').value = m.id;
                document.getElementById('measureName').value = m.action;
                document.getElementById('measureCategory').value = m.category;
                document.getElementById('measureDesc').value = m.desc || '';
                document.getElementById('measureOwner').value = m.owner || '';
                document.getElementById('measureActive').checked = m.active !== false;
                
                this.currentTags = m.tags || [];
                this.renderTags();
                this.updateFrequencyPreview();
                
                document.getElementById('editFormTitle').textContent = 'ç¼–è¾‘æ£€æŸ¥é¡¹';
                this.switchAdminTab('edit');
            }

            addTag() {
                const input = document.getElementById('newTag');
                const tag = input.value.trim();
                if (tag && !this.currentTags.includes(tag)) {
                    this.currentTags.push(tag);
                    this.renderTags();
                    input.value = '';
                }
            }

            removeTag(tag) {
                this.currentTags = this.currentTags.filter(t => t !== tag);
                this.renderTags();
            }

            renderTags() {
                const container = document.getElementById('tagsContainer');
                container.innerHTML = this.currentTags.map(t => `
                    <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs bg-blue-500/20 text-blue-300 border border-blue-500/30">
                        ${t}
                        <button type="button" onclick="app.removeTag('${t}')" class="hover:text-white">Ã—</button>
                    </span>
                `).join('');
            }

            saveMeasure(e) {
                e.preventDefault();
                
                const id = document.getElementById('editId').value;
                const measureData = {
                    id: id || `m-${Date.now()}`,
                    action: document.getElementById('measureName').value,
                    category: document.getElementById('measureCategory').value,
                    desc: document.getElementById('measureDesc').value,
                    owner: document.getElementById('measureOwner').value,
                    tags: [...this.currentTags],
                    active: document.getElementById('measureActive').checked,
                    createdAt: id ? this.measures.find(m => m.id === id)?.createdAt : new Date().toISOString()
                };

                if (id) {
                    const idx = this.measures.findIndex(m => m.id === id);
                    if (idx !== -1) this.measures[idx] = { ...this.measures[idx], ...measureData };
                } else {
                    this.measures.push(measureData);
                }

                this.saveMeasures();
                this.showToast('æ£€æŸ¥é¡¹å·²ä¿å­˜');
                this.switchAdminTab('measures');
            }

            toggleMeasureActive(id) {
                const m = this.measures.find(x => x.id === id);
                if (m) {
                    m.active = !m.active;
                    this.saveMeasures();
                    this.renderMeasuresList();
                    this.showToast(m.active ? 'æ£€æŸ¥é¡¹å·²å¯ç”¨' : 'æ£€æŸ¥é¡¹å·²åœç”¨');
                }
            }

            deleteMeasure(id) {
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ£€æŸ¥é¡¹å—ï¼Ÿæ‰€æœ‰å±‚çº§çš„å®¡æ ¸è®°å½•éƒ½å°†è¢«æ¸…é™¤ã€‚')) return;
                
                this.measures = this.measures.filter(m => m.id !== id);
                Object.keys(this.checks).forEach(key => {
                    if (key.startsWith(id + '-')) delete this.checks[key];
                });
                localStorage.setItem('lpa_checks', JSON.stringify(this.checks));
                
                this.saveMeasures();
                this.renderMeasuresList();
                this.showToast('æ£€æŸ¥é¡¹å·²åˆ é™¤');
            }

            quickCheck(measureId, level, index) {
                const dateStr = this.currentDate.toISOString().split('T')[0];
                const key = `${measureId}-${level}-${dateStr}`;
                const current = this.checks[key] || { count: 0, completed: false };
                
                if (current.count > index) current.count = index;
                else current.count = index + 1;
                
                current.completed = current.count >= 5;
                this.checks[key] = current;
                
                localStorage.setItem('lpa_checks', JSON.stringify(this.checks));
                this.render();
                this.updateStats();
            }

            openDetail(measureId, level) {
                const m = this.measures.find(x => x.id === measureId);
                const dateStr = this.currentDate.toISOString().split('T')[0];
                const status = this.getCheckStatus(measureId, level, dateStr);
                
                const levelNames = { dept: 'éƒ¨é—¨çº§', line: 'äº§çº¿çº§', quality: 'è´¨é‡çº§' };
                const levelColors = { dept: 'blue', line: 'green', quality: 'purple' };
                
                document.getElementById('modalTitle').textContent = m.action;
                document.getElementById('modalLevelBadge').className = `inline-block px-3 py-1 rounded-full text-xs font-medium bg-${levelColors[level]}-500/20 text-${levelColors[level]}-300 border border-${levelColors[level]}-500/30 mb-2`;
                document.getElementById('modalLevelBadge').textContent = levelNames[level];
                document.getElementById('modalCycleInfo').textContent = this.getCycleInfo(level, this.currentDate);
                
                let checkSection = '';
                if (level === 'dept') {
                    checkSection = `
                        <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                            <h4 class="text-sm font-medium text-slate-400 mb-3">æ£€æŸ¥ç¡®è®¤ (${status.count || 0}/5)</h4>
                            <div class="flex gap-2">
                                ${Array.from({length: 5}, (_, i) => `
                                    <button onclick="app.toggleCheckBox(this, ${i})" class="flex-1 h-12 rounded-lg border-2 transition-all ${status.count > i ? 'bg-blue-500 border-blue-500' : 'border-slate-600 hover:border-blue-400'} flex items-center justify-center">
                                        ${status.count > i ? '<svg class="w-6 h-6 text-white check-animation" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : `<span class="text-slate-500 font-bold">${i + 1}</span>`}
                                    </button>
                                `).join('')}
                            </div>
                            <p class="text-xs text-slate-500 mt-2">éƒ¨é—¨çº§éœ€å®Œæˆ5æ¬¡ç¡®è®¤</p>
                        </div>
                    `;
                } else {
                    checkSection = `
                        <div class="flex items-center justify-between bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                            <span class="text-slate-300">å®¡æ ¸çŠ¶æ€</span>
                            <button onclick="app.toggleComplete(this)" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${status.completed ? 'bg-green-500' : 'bg-slate-600'}">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${status.completed ? 'translate-x-6' : 'translate-x-1'}"></span>
                            </button>
                        </div>
                    `;
                }
                
                const content = `
                    <div class="space-y-4">
                        <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                            <h4 class="text-sm font-medium text-slate-400 mb-2">æ£€æŸ¥æ ‡å‡†</h4>
                            <p class="text-slate-200">${m.desc || 'ç¡®è®¤' + m.action + 'ç¬¦åˆæ ‡å‡†è¦æ±‚ã€‚'}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                                <h4 class="text-sm font-medium text-slate-400 mb-1">ç±»åˆ«</h4>
                                <p class="text-lg font-semibold text-white">${m.category}</p>
                            </div>
                            <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                                <h4 class="text-sm font-medium text-slate-400 mb-1">è´£ä»»äºº</h4>
                                <p class="text-lg font-semibold text-white">${m.owner || 'æœªæŒ‡å®š'}</p>
                            </div>
                        </div>

                        <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                            <h4 class="text-sm font-medium text-slate-400 mb-2">å®¡æ ¸å¤‡æ³¨</h4>
                            <textarea id="checkNote" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 resize-none" rows="3" placeholder="è¾“å…¥å®¡æ ¸å¤‡æ³¨...">${status.note || ''}</textarea>
                        </div>

                        ${checkSection}
                    </div>
                `;
                
                document.getElementById('modalBody').innerHTML = content;
                document.getElementById('detailModal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('modalContent').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('modalContent').classList.add('scale-100', 'opacity-100');
                }, 10);
                
                this.currentDetail = { measureId, level, dateStr };
            }

            closeModal() {
                document.getElementById('modalContent').classList.remove('scale-100', 'opacity-100');
                document.getElementById('modalContent').classList.add('scale-95', 'opacity-0');
                setTimeout(() => document.getElementById('detailModal').classList.add('hidden'), 300);
            }

            toggleCheckBox(btn, index) {
                const checkboxes = btn.parentElement.querySelectorAll('button');
                if (btn.classList.contains('bg-blue-500')) {
                    for (let i = index; i < checkboxes.length; i++) {
                        checkboxes[i].classList.remove('bg-blue-500', 'border-blue-500');
                        checkboxes[i].classList.add('border-slate-600');
                        checkboxes[i].innerHTML = `<span class="text-slate-500 font-bold">${i + 1}</span>`;
                    }
                } else {
                    for (let i = 0; i <= index; i++) {
                        if (!checkboxes[i].classList.contains('bg-blue-500')) {
                            checkboxes[i].classList.remove('border-slate-600');
                            checkboxes[i].classList.add('bg-blue-500', 'border-blue-500');
                            checkboxes[i].innerHTML = `<svg class="w-6 h-6 text-white check-animation" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>`;
                        }
                    }
                }
            }

            toggleComplete(btn) {
                const isCompleted = btn.classList.contains('bg-green-500');
                btn.classList.toggle('bg-green-500');
                btn.classList.toggle('bg-slate-600');
                btn.querySelector('span').classList.toggle('translate-x-6');
                btn.querySelector('span').classList.toggle('translate-x-1');
            }

            saveCheck() {
                if (!this.currentDetail) return;
                const { measureId, level, dateStr } = this.currentDetail;
                const note = document.getElementById('checkNote').value;
                
                let completed = false;
                let count = 0;
                
                if (level === 'dept') {
                    const checkboxes = document.querySelectorAll('#modalBody button');
                    count = Array.from(checkboxes).filter(b => b.classList.contains('bg-blue-500')).length;
                    completed = count >= 5;
                } else {
                    const toggle = document.querySelector('#modalBody button[onclick="app.toggleComplete(this)"]');
                    completed = toggle.classList.contains('bg-green-500');
                    count = completed ? 1 : 0;
                }
                
                this.checks[`${measureId}-${level}-${dateStr}`] = { completed, count, note };
                localStorage.setItem('lpa_checks', JSON.stringify(this.checks));
                
                this.closeModal();
                this.render();
                this.updateStats();
                this.showToast('å®¡æ ¸è®°å½•å·²ä¿å­˜');
            }

            updateStats() {
                const dateStr = this.currentDate.toISOString().split('T')[0];
                let completed = 0, pending = 0;
                
                const levels = ['dept', 'line', 'quality'];
                this.measures.forEach(m => {
                    if (!m.active) return;
                    levels.forEach(level => {
                        if (this.shouldShowMeasure(m, level, this.currentDate)) {
                            const status = this.getCheckStatus(m.id, level, dateStr);
                            if (status.completed) completed++;
                            else pending++;
                        }
                    });
                });
                
                document.getElementById('completedToday').textContent = completed;
                document.getElementById('pendingToday').textContent = pending;
                document.getElementById('totalMeasures').textContent = this.measures.filter(m => m.active).length;
            }

            jumpToToday() {
                this.currentDate = new Date();
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                document.getElementById('datePicker').value = `${yyyy}-${mm}-${dd}`;
                this.render();
                this.updateStats();
                this.updateCycleInfo();
            }

            exportReport() {
                const dateStr = this.currentDate.toISOString().split('T')[0];
                let csv = 'æ—¥æœŸ,å±‚çº§,ç±»åˆ«,æ£€æŸ¥é¡¹,çŠ¶æ€,æ£€æŸ¥æ¬¡æ•°,è´£ä»»äºº,å¤‡æ³¨\n';
                
                const levels = ['dept', 'line', 'quality'];
                const levelNames = { dept: 'éƒ¨é—¨çº§', line: 'äº§çº¿çº§', quality: 'è´¨é‡çº§' };
                
                this.measures.forEach(m => {
                    if (!m.active) return;
                    levels.forEach(level => {
                        if (this.shouldShowMeasure(m, level, this.currentDate)) {
                            const status = this.getCheckStatus(m.id, level, dateStr);
                            csv += `${dateStr},${levelNames[level]},${m.category},"${m.action}",${status.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'},${status.count || 0},${m.owner || ''},"${status.note || ''}"\n`;
                        }
                    });
                });
                
                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `åˆ†å±‚å®¡æ ¸æŠ¥å‘Š_${dateStr}.csv`;
                link.click();
                this.showToast('æŠ¥å‘Šå·²å¯¼å‡º');
            }

            backupData() {
                const data = {
                    measures: this.measures,
                    checks: this.checks,
                    settings: this.settings,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `LPAå¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                this.showToast('æ•°æ®å·²å¤‡ä»½');
            }

            restoreData(input) {
                const file = input.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.measures) {
                            this.measures = data.measures;
                            this.saveMeasures();
                        }
                        if (data.checks) {
                            this.checks = data.checks;
                            localStorage.setItem('lpa_checks', JSON.stringify(this.checks));
                        }
                        if (data.settings) {
                            this.settings = data.settings;
                            localStorage.setItem('lpa_settings', JSON.stringify(this.settings));
                        }
                        this.showToast('æ•°æ®å·²æ¢å¤');
                        this.render();
                        this.updateStats();
                        this.renderMeasuresList();
                    } catch (err) {
                        alert('æ–‡ä»¶æ ¼å¼é”™è¯¯');
                    }
                };
                reader.readAsText(file);
            }

            clearAllData() {
                if (!confirm('âš ï¸ è­¦å‘Šï¼šè¿™å°†æ¸…ç©ºæ‰€æœ‰æ£€æŸ¥é¡¹å’Œå®¡æ ¸è®°å½•ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) return;
                if (!confirm('å†æ¬¡ç¡®è®¤ï¼šæ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) return;
                
                this.measures = [];
                this.checks = {};
                localStorage.removeItem('lpa_measures');
                localStorage.removeItem('lpa_checks');
                localStorage.removeItem('lpa_settings');
                
                // æ¢å¤é»˜è®¤è®¾ç½®
                this.settings = { ...this.defaultSettings };
                localStorage.setItem('lpa_settings', JSON.stringify(this.settings));
                
                this.saveMeasures();
                this.renderMeasuresList();
                this.render();
                this.updateStats();
                this.showToast('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
            }

            showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-xl shadow-lg shadow-green-500/25 transform translate-y-20 opacity-0 transition-all duration-300 z-[10000] flex items-center gap-2';
                toast.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>${message}`;
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.remove('translate-y-20', 'opacity-0'), 100);
                setTimeout(() => {
                    toast.classList.add('translate-y-20', 'opacity-0');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        }
    </script>
</body>
</html>